---
import Layout from '../layouts/Layout.astro';
import Header from '../components/public/Header.astro';
import Hero from '../components/public/Hero.astro';
import Historia from '../components/public/Historia.astro';
import TransitionBridge from '../components/public/TransitionBridge.astro';
import Carta from '../components/public/Carta.astro';
import ScrollToTop from '../components/public/ScrollToTop.astro';
import Footer from '../components/public/Footer.astro';

// Importar utilidades i18n
import { 
  getI18nInfo, 
  getSEOMetadata, 
  getAlternateUrls,
  safeTranslation,
  getTextDirection 
} from '../utils/astro-i18n-utils.js';

// Obtener información de i18n
const { locale, i18n, isDefaultLocale } = getI18nInfo(Astro);

// Obtener metadatos SEO multiidioma
const seoData = getSEOMetadata({
  title: safeTranslation('title', Astro, 'El Palleter - Tapas y Parrilla en Benissa'),
  description: safeTranslation('description', Astro, 'Restaurante El Palleter en Benissa. Auténtica cocina mediterránea desde 1985.')
}, Astro);

// Obtener URLs alternativas para hreflang
const alternateUrls = getAlternateUrls(Astro);

// Dirección del texto (por si añades árabe u otros idiomas RTL en el futuro)
const textDirection = getTextDirection(Astro);
---

<Layout 
  title={seoData.title} 
  description={seoData.description}
  lang={locale}
  dir={textDirection}
>
  <!-- SEO mejorado con hreflang y multiidioma -->
  <Fragment slot="head">
    <!-- Canonical URL -->
    <link rel="canonical" href={seoData.canonical} />
    
    <!-- URLs alternativas para cada idioma -->
    {Object.entries(alternateUrls).map(([lang, url]) => (
      <link rel="alternate" hreflang={lang} href={url} />
    ))}
    
    <!-- URL alternativa para cualquier idioma no especificado -->
    <link rel="alternate" hreflang="x-default" href={alternateUrls.es} />
    
    <!-- Open Graph multiidioma -->
    <meta property="og:locale" content={locale} />
    <meta property="og:url" content={seoData.openGraph.url} />
    <meta property="og:title" content={seoData.openGraph.title} />
    <meta property="og:description" content={seoData.openGraph.description} />
    
    <!-- Locales alternativos para Open Graph -->
    {seoData.openGraph.alternateLocales.map(altLocale => (
      <meta property="og:locale:alternate" content={altLocale} />
    ))}
    
    <!-- Twitter Card -->
    <meta name="twitter:title" content={seoData.twitter.title} />
    <meta name="twitter:description" content={seoData.twitter.description} />
    
    <!-- JSON-LD estructurado -->
    <script type="application/ld+json" set:html={JSON.stringify(seoData.structuredData)} />
  </Fragment>

  <!-- Contenido de la página (sin cambios) -->
  <Header />
  <Hero />
  <TransitionBridge />
  <Historia />
  <TransitionBridge />
  <Carta />
  <ScrollToTop />
  <Footer />
</Layout>