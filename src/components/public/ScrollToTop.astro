---
export const prerender = true;
---
<button id="scrollToTop" class="scroll-to-top" aria-label="Volver arriba">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 4L12 20M12 4L18 10M12 4L6 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
</button>

<style>
    /* === BOTÓN PRINCIPAL === */
    .scroll-to-top {
        position: fixed;
        bottom: var(--space-8);                         /* 2rem */
        right: var(--space-8);                          /* 2rem */
        width: calc(var(--space-8) + var(--space-6));   /* 3.5rem */
        height: calc(var(--space-8) + var(--space-6));  /* 3.5rem */
        
        /* Gradiente usando variables de acento */
        background: linear-gradient(45deg, var(--accent-active), var(--accent-primary));
        border: none;
        border-radius: var(--radius-full);              /* 50% */
        color: var(--text-primary);
        cursor: pointer;
        z-index: var(--z-toast);                        /* 1030 */
        
        /* Estados de visibilidad */
        opacity: 0;
        visibility: hidden;
        transform: translateY(var(--space-5));          /* 20px */
        transition: var(--transition-base);             /* all 0.3s ease-out */
        
        /* Sombra con color de acento */
        box-shadow: var(--shadow-accent);               /* 0 4px 20px rgba(accent, 0.3) */
        
        /* Centrado del contenido */
        display: flex;
        align-items: center;
        justify-content: center;
        
        /* Optimización de rendering */
        contain: layout style paint;
        will-change: transform, opacity, box-shadow;
    }

    /* === ESTADO VISIBLE === */
    .scroll-to-top.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    /* === ESTADOS INTERACTIVOS === */
    .scroll-to-top:hover {
        background: linear-gradient(45deg, var(--accent-hover), var(--accent-active));
        transform: translateY(calc(-1 * var(--space-1))); /* -3px */
        box-shadow: var(--shadow-accent-lg);             /* Sombra más pronunciada */
    }

    .scroll-to-top:active {
        transform: translateY(calc(-1 * var(--space-1) / 3)); /* -1px */
        transition: var(--transition-fast);              /* Transición más rápida en active */
    }

    .scroll-to-top:focus-visible {
        outline: var(--border-2) solid var(--focus-ring);
        outline-offset: var(--space-1);
    }

    /* === ICONO SVG === */
    .scroll-to-top svg {
        width: var(--space-6);                          /* 1.5rem */
        height: var(--space-6);                         /* 1.5rem */
        transition: var(--transition-transform);        /* transform 0.3s ease-out */
        flex-shrink: 0;
    }

    .scroll-to-top:hover svg {
        transform: translateY(calc(-1 * var(--space-1))); /* -2px */
    }

    /* === ANIMACIÓN DE PULSO === */
    .scroll-to-top::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: var(--radius-full);
        background: linear-gradient(45deg, var(--accent-active), var(--accent-primary));
        opacity: 0;
        transform: scale(1);
        animation: pulse var(--duration-1000) var(--ease-in-out) infinite;
        z-index: -1;
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
            opacity: 0.7;
        }
        50% {
            transform: scale(1.1);
            opacity: 0.3;
        }
        100% {
            transform: scale(1.2);
            opacity: 0;
        }
    }

    /* === VARIANTES DE TEMA === */
    
    /* Tema claro */
    [data-theme="light"] .scroll-to-top {
        color: var(--bg-primary);                       /* Texto oscuro en fondo claro */
        box-shadow: var(--shadow-md);                   /* Sombra más sutil */
    }
    
    [data-theme="light"] .scroll-to-top:hover {
        box-shadow: var(--shadow-lg);
    }

    /* Tema dorado */
    [data-theme="gold"] .scroll-to-top {
        background: linear-gradient(45deg, var(--accent-active), var(--accent-primary));
    }
    
    [data-theme="gold"] .scroll-to-top:hover {
        background: linear-gradient(45deg, var(--accent-hover), var(--accent-active));
    }

    /* Tema azul */
    [data-theme="blue"] .scroll-to-top {
        background: linear-gradient(45deg, var(--accent-active), var(--accent-primary));
    }
    
    [data-theme="blue"] .scroll-to-top:hover {
        background: linear-gradient(45deg, var(--accent-hover), var(--accent-active));
    }

    /* Tema restaurante */
    [data-theme="restaurant"] .scroll-to-top {
        background: linear-gradient(45deg, var(--accent-active), var(--accent-primary));
        color: var(--text-primary);                     /* Asegurar contraste en tema cálido */
    }
    
    [data-theme="restaurant"] .scroll-to-top:hover {
        background: linear-gradient(45deg, var(--accent-hover), var(--accent-active));
    }

    /* === RESPONSIVE === */
    
    /* Tablet */
    @media (max-width: 768px) {
        .scroll-to-top {
            bottom: var(--space-6);                     /* 1.5rem */
            right: var(--space-6);                      /* 1.5rem */
            width: var(--space-12);                     /* 3rem */
            height: var(--space-12);                    /* 3rem */
        }
        
        .scroll-to-top svg {
            width: var(--space-5);                      /* 1.25rem */
            height: var(--space-5);                     /* 1.25rem */
        }
    }

    /* Mobile */
    @media (max-width: 420px) {
        .scroll-to-top {
            bottom: var(--space-4);                     /* 1rem */
            right: var(--space-4);                      /* 1rem */
            width: var(--space-10);                     /* 2.5rem */
            height: var(--space-10);                    /* 2.5rem */
        }
        
        .scroll-to-top svg {
            width: var(--space-4);                      /* 1rem */
            height: var(--space-4);                     /* 1rem */
        }
    }

    /* === ACCESIBILIDAD === */
    
    /* Reducir movimiento si el usuario lo prefiere */
    @media (prefers-reduced-motion: reduce) {
        .scroll-to-top,
        .scroll-to-top svg,
        .scroll-to-top::before {
            transition: none;
            animation: none;
        }
        
        .scroll-to-top:hover {
            transform: none;
        }
        
        .scroll-to-top:hover svg {
            transform: none;
        }
    }
    
    /* Alto contraste */
    @media (prefers-contrast: high) {
        .scroll-to-top {
            background: var(--accent-primary) !important;
            border: var(--border-2) solid var(--text-primary);
            box-shadow: var(--shadow-xl);
        }
        
        .scroll-to-top:hover {
            background: var(--accent-hover) !important;
            border-color: var(--accent-primary);
        }
    }

    /* === MEJORAS DE RENDIMIENTO === */
    
    /* Optimización de GPU para animaciones suaves */
    .scroll-to-top {
        backface-visibility: hidden;
        transform-style: preserve-3d;
    }

    /* === VARIANTES ADICIONALES === */
    
    /* Variante compacta */
    .scroll-to-top.compact {
        width: var(--space-10);                         /* 2.5rem */
        height: var(--space-10);                        /* 2.5rem */
        bottom: var(--space-4);                         /* 1rem */
        right: var(--space-4);                          /* 1rem */
    }
    
    .scroll-to-top.compact svg {
        width: var(--space-4);                          /* 1rem */
        height: var(--space-4);                         /* 1rem */
    }

    /* Variante con texto */
    .scroll-to-top.with-text {
        width: auto;
        padding: var(--space-3) var(--space-4);
        border-radius: var(--radius-full);
        gap: var(--space-2);
        font-size: var(--text-sm);
        font-weight: var(--font-medium);
        white-space: nowrap;
    }

    /* === SOPORTE PARA DISPOSITIVOS CON NOTCH === */
    
    .scroll-to-top {
        bottom: calc(var(--space-8) + env(safe-area-inset-bottom));
        right: calc(var(--space-8) + env(safe-area-inset-right));
    }
    
    @media (max-width: 768px) {
        .scroll-to-top {
            bottom: calc(var(--space-6) + env(safe-area-inset-bottom));
            right: calc(var(--space-6) + env(safe-area-inset-right));
        }
    }
    
    @media (max-width: 420px) {
        .scroll-to-top {
            bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
            right: calc(var(--space-4) + env(safe-area-inset-right));
        }
    }

    /* === ESTADO DE CARGA/DISABLED === */
    
    .scroll-to-top:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        animation: none;
    }
    
    .scroll-to-top:disabled:hover {
        background: linear-gradient(45deg, var(--accent-active), var(--accent-primary));
        transform: none;
        box-shadow: var(--shadow-accent);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const scrollToTopBtn = document.getElementById('scrollToTop');
        
        if (!scrollToTopBtn) return;

        // Mostrar/ocultar botón según el scroll
        const toggleVisibility = () => {
            const scrolled = window.pageYOffset;
            const windowHeight = window.innerHeight;
            
            // Mostrar después de hacer scroll más de media pantalla
            if (scrolled > windowHeight * 0.5) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        };

        // Scroll suave hacia arriba
        const scrollToTop = () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        };

        // Throttle del scroll para mejor performance
        let ticking = false;
        const throttledToggleVisibility = () => {
            if (!ticking) {
                requestAnimationFrame(() => {
                    toggleVisibility();
                    ticking = false;
                });
                ticking = true;
            }
        };

        // Event listeners
        window.addEventListener('scroll', throttledToggleVisibility, { passive: true });
        scrollToTopBtn.addEventListener('click', scrollToTop);

        // Manejar teclas de accesibilidad
        scrollToTopBtn.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                scrollToTop();
            }
        });

        // Verificación inicial
        toggleVisibility();
    });
</script>