---
export const prerender = true;
---
<button id="scrollToTop" class="scroll-to-top" aria-label="Volver arriba">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 4L12 20M12 4L18 10M12 4L6 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
</button>

<style>
    .scroll-to-top {
        position: fixed;
        bottom: var(--space-8);
        right: var(--space-8);
        width: calc(var(--space-8) + var(--space-6));
        height: calc(var(--space-8) + var(--space-6));
        
        background: linear-gradient(45deg, var(--accent-active), var(--accent-primary));
        border: none;
        border-radius: var(--radius-full);
        color: var(--text-primary);
        cursor: pointer;
        z-index: var(--z-toast);
        
        opacity: 0;
        visibility: hidden;
        transform: translateY(var(--space-5));
        transition: var(--transition-base);
        
        box-shadow: var(--shadow-accent);
        
        display: flex;
        align-items: center;
        justify-content: center;
        
        contain: layout style paint;
        will-change: transform, opacity, box-shadow;
    }

    .scroll-to-top.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .scroll-to-top:hover {
        background: linear-gradient(45deg, var(--accent-hover), var(--accent-active));
        transform: translateY(calc(-1 * var(--space-1)));
        box-shadow: var(--shadow-accent-lg);
    }

    .scroll-to-top:active {
        transform: translateY(calc(-1 * var(--space-1) / 3));
        transition: var(--transition-fast);
    }

    .scroll-to-top:focus-visible {
        outline: var(--border-2) solid var(--focus-ring);
        outline-offset: var(--space-1);
    }

    .scroll-to-top svg {
        width: var(--space-6);
        height: var(--space-6);
        transition: var(--transition-transform);
        flex-shrink: 0;
    }

    .scroll-to-top:hover svg {
        transform: translateY(calc(-1 * var(--space-1)));
    }

    .scroll-to-top::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: var(--radius-full);
        background: linear-gradient(45deg, var(--accent-active), var(--accent-primary));
        opacity: 0;
        transform: scale(1);
        animation: pulse var(--duration-1000) var(--ease-in-out) infinite;
        z-index: -1;
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
            opacity: 0.7;
        }
        50% {
            transform: scale(1.1);
            opacity: 0.3;
        }
        100% {
            transform: scale(1.2);
            opacity: 0;
        }
    }

    html[data-theme="light"] .scroll-to-top {
        color: var(--bg-primary);
        box-shadow: var(--shadow-md);
    }
    
    html[data-theme="light"] .scroll-to-top:hover {
        box-shadow: var(--shadow-lg);
    }

    @media (max-width: 768px) {
        .scroll-to-top {
            bottom: var(--space-6);
            right: var(--space-6);
            width: var(--space-12);
            height: var(--space-12);
        }
        
        .scroll-to-top svg {
            width: var(--space-5);
            height: var(--space-5);
        }
    }

    @media (max-width: 420px) {
        .scroll-to-top {
            bottom: var(--space-4);
            right: var(--space-4);
            width: var(--space-10);
            height: var(--space-10);
        }
        
        .scroll-to-top svg {
            width: var(--space-4);
            height: var(--space-4);
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .scroll-to-top,
        .scroll-to-top svg,
        .scroll-to-top::before {
            transition: none;
            animation: none;
        }
        
        .scroll-to-top:hover {
            transform: none;
        }
        
        .scroll-to-top:hover svg {
            transform: none;
        }
    }
    
    @media (prefers-contrast: high) {
        .scroll-to-top {
            background: var(--accent-primary) !important;
            border: var(--border-2) solid var(--text-primary);
            box-shadow: var(--shadow-xl);
        }
        
        .scroll-to-top:hover {
            background: var(--accent-hover) !important;
            border-color: var(--accent-primary);
        }
    }

    .scroll-to-top {
        backface-visibility: hidden;
        transform-style: preserve-3d;
        bottom: calc(var(--space-8) + env(safe-area-inset-bottom));
        right: calc(var(--space-8) + env(safe-area-inset-right));
    }
    
    @media (max-width: 768px) {
        .scroll-to-top {
            bottom: calc(var(--space-6) + env(safe-area-inset-bottom));
            right: calc(var(--space-6) + env(safe-area-inset-right));
        }
    }
    
    @media (max-width: 420px) {
        .scroll-to-top {
            bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
            right: calc(var(--space-4) + env(safe-area-inset-right));
        }
    }
    
    .scroll-to-top:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        animation: none;
    }
    
    .scroll-to-top:disabled:hover {
        background: linear-gradient(45deg, var(--accent-active), var(--accent-primary));
        transform: none;
        box-shadow: var(--shadow-accent);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const scrollToTopBtn = document.getElementById('scrollToTop');
        
        if (!scrollToTopBtn) return;

        const toggleVisibility = () => {
            const scrolled = window.pageYOffset;
            const windowHeight = window.innerHeight;
            
            if (scrolled > windowHeight * 0.5) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        };

        const scrollToTop = () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        };

        let ticking = false;
        const throttledToggleVisibility = () => {
            if (!ticking) {
                requestAnimationFrame(() => {
                    toggleVisibility();
                    ticking = false;
                });
                ticking = true;
            }
        };

        window.addEventListener('scroll', throttledToggleVisibility, { passive: true });
        scrollToTopBtn.addEventListener('click', scrollToTop);

        scrollToTopBtn.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                scrollToTop();
            }
        });

        toggleVisibility();
    });
</script>