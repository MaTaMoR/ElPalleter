---
export const prerender = true;

import ResponsiveImage from './ResponsiveImage.astro';

interface Props {
    imageId: string;
    alt?: string;
    className?: string;
    overlayColor?: string;
    overlayOpacity?: number;
    fallbackImage?: string;
    adaptiveOverlay?: boolean;
}

const {
    imageId,
    alt = "Fondo Hero",
    className = '',
    overlayColor = 'rgba(0, 0, 0, 0.25)',
    overlayOpacity = 1,
    adaptiveOverlay = true
} = Astro.props;

// Clases dinámicas usando design system
const heroClasses = [
    'hero-background',
    adaptiveOverlay && 'adaptive-overlay',
    className
].filter(Boolean).join(' ');
---

<div class={heroClasses} id="hero">
    <!-- Imagen de fondo responsiva -->
    <ResponsiveImage
        imageId={imageId}
        alt={alt}
        className="hero-bg-image"
        loading="eager"
        decoding="async"
        sizes="100vw"
        objectFit="cover"
        objectPosition="center"
        priority={true}
        fallbackText="Imagen de fondo no disponible"
        fallbackIcon="picture"
    />
    
    <!-- Overlay optimizado para elementos blancos -->
    {adaptiveOverlay && (
        <div class="hero-overlay-white-optimized"></div>
    )}
    
    <!-- Slot para contenido del hero -->
    <div class="hero-content">
        <slot />
    </div>
</div>

<style>
    /* === HERO BACKGROUND USANDO DESIGN TOKENS === */
    .hero-background {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        color: #ffffff; /* Siempre blanco para elementos del hero */
        
        /* Optimizaciones de performance */
        transform: translate3d(0, 0, 0);
        backface-visibility: hidden;
        contain: layout style paint;
        will-change: transform;
    }

    /* === IMAGEN DE FONDO === */
    .hero-background :global(.hero-bg-image) {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        object-fit: cover;
        object-position: center;
        
        /* Optimización de GPU */
        will-change: transform;
        transform: translate3d(0, 0, 0);
        
        /* Transición suave para filtros */
        transition: filter var(--duration-300) var(--ease-out);
    }

    /* === OVERLAY BASE === */
    .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
        background: var(--bg-overlay);
        transition: background var(--duration-300) var(--ease-out);
    }

    /* === OVERLAY OPTIMIZADO PARA ELEMENTOS BLANCOS === */
    .hero-overlay-white-optimized {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
        pointer-events: none;
        transition: background var(--duration-300) var(--ease-out),
                    opacity var(--duration-300) var(--ease-out);
        
        /* Overlay muy sutil por defecto - elementos blancos necesitan poco contraste en imágenes oscuras */
        background: rgba(0, 0, 0, 0.05);
        opacity: 1;
    }

    /* Overlay adaptativo para tema claro - más fuerte para mantener contraste con elementos blancos */
    :root[data-theme="light"] .hero-overlay-white-optimized,
    html[data-theme="light"] .hero-overlay-white-optimized {
        /* Gradiente más fuerte en tema claro para que el blanco destaque */
        background: linear-gradient(
            rgba(0, 0, 0, 0.4) 0%,
            rgba(0, 0, 0, 0.45) 25%,
            rgba(0, 0, 0, 0.5) 50%,
            rgba(0, 0, 0, 0.55) 100%
        );
    }

    /* === OPTIMIZACIÓN PARA TEMA DORADO === */
    :root[data-theme="gold"] .hero-overlay-white-optimized,
    html[data-theme="gold"] .hero-overlay-white-optimized {
        /* Overlay más cálido para complementar el tema dorado */
        background: linear-gradient(
            rgba(0, 0, 0, 0.3) 0%,
            rgba(20, 10, 0, 0.35) 50%,
            rgba(0, 0, 0, 0.4) 100%
        );
    }

    /* === OPTIMIZACIÓN PARA TEMA AZUL === */
    :root[data-theme="blue"] .hero-overlay-white-optimized,
    html[data-theme="blue"] .hero-overlay-white-optimized {
        /* Overlay más frío para complementar el tema azul */
        background: linear-gradient(
            rgba(0, 0, 0, 0.3) 0%,
            rgba(0, 10, 20, 0.35) 50%,
            rgba(0, 0, 0, 0.4) 100%
        );
    }

    /* === OPTIMIZACIÓN PARA TEMA RESTAURANTE === */
    :root[data-theme="restaurant"] .hero-overlay-white-optimized,
    html[data-theme="restaurant"] .hero-overlay-white-optimized {
        /* Overlay más cálido y terroso */
        background: linear-gradient(
            rgba(0, 0, 0, 0.3) 0%,
            rgba(20, 15, 10, 0.35) 50%,
            rgba(0, 0, 0, 0.4) 100%
        );
    }

    /* === REDUCIR OVERLAY BASE CUANDO SE USA OVERLAY OPTIMIZADO === */
    .hero-background.adaptive-overlay .hero-overlay {
        opacity: 0.2; /* Muy sutil ya que el overlay optimizado hace el trabajo principal */
    }

    /* === FALLBACK PERSONALIZADO PARA HERO === */
    .hero-background :global(.responsive-image-fallback) {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        
        /* Usando tokens para el fondo de fallback */
        background: linear-gradient(135deg, 
            var(--dark-600) 0%, 
            var(--dark-400) 100%
        );
        border: none;
        border-radius: 0;
        color: var(--text-secondary);
        min-height: 100vh;
    }

    .hero-background :global(.responsive-image-fallback .fallback-icon) {
        color: var(--text-muted);
    }

    .hero-background :global(.responsive-image-fallback .fallback-title) {
        color: #ffffff; /* Siempre blanco para consistencia */
    }

    /* === CONTENIDO === */
    .hero-content {
        position: relative;
        z-index: 3; /* Por encima de ambos overlays */
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
    }

    /* === VARIANTES ADICIONALES DEL OVERLAY === */
    
    /* Overlay suave (menos contraste) */
    .hero-background.adaptive-soft .hero-overlay-white-optimized {
        background: rgba(0, 0, 0, 0.02);
    }
    
    :root[data-theme="light"] .hero-background.adaptive-soft .hero-overlay-white-optimized,
    html[data-theme="light"] .hero-background.adaptive-soft .hero-overlay-white-optimized {
        background: linear-gradient(
            rgba(0, 0, 0, 0.3) 0%,
            rgba(0, 0, 0, 0.35) 50%,
            rgba(0, 0, 0, 0.4) 100%
        );
    }

    /* Overlay fuerte (más contraste) */
    .hero-background.adaptive-strong .hero-overlay-white-optimized {
        background: rgba(0, 0, 0, 0.15);
    }
    
    :root[data-theme="light"] .hero-background.adaptive-strong .hero-overlay-white-optimized,
    html[data-theme="light"] .hero-background.adaptive-strong .hero-overlay-white-optimized {
        background: linear-gradient(
            rgba(0, 0, 0, 0.6) 0%,
            rgba(0, 0, 0, 0.65) 25%,
            rgba(0, 0, 0, 0.7) 75%,
            rgba(0, 0, 0, 0.75) 100%
        );
    }

    /* === OVERLAY CON EFECTO CRISTAL === */
    .hero-background.glass-adaptive .hero-overlay-white-optimized {
        backdrop-filter: var(--backdrop-blur-subtle);
        background: rgba(0, 0, 0, 0.1);
    }
    
    :root[data-theme="light"] .hero-background.glass-adaptive .hero-overlay-white-optimized,
    html[data-theme="light"] .hero-background.glass-adaptive .hero-overlay-white-optimized {
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: var(--backdrop-blur);
    }

    /* === GRADIENTE VERTICAL OPTIMIZADO === */
    .hero-background.gradient-adaptive .hero-overlay-white-optimized {
        background: linear-gradient(
            180deg,
            transparent 0%,
            rgba(0, 0, 0, 0.05) 30%,
            rgba(0, 0, 0, 0.15) 70%,
            rgba(0, 0, 0, 0.25) 100%
        );
    }
    
    :root[data-theme="light"] .hero-background.gradient-adaptive .hero-overlay-white-optimized,
    html[data-theme="light"] .hero-background.gradient-adaptive .hero-overlay-white-optimized {
        background: linear-gradient(
            180deg,
            rgba(0, 0, 0, 0.3) 0%,
            rgba(0, 0, 0, 0.4) 30%,
            rgba(0, 0, 0, 0.55) 70%,
            rgba(0, 0, 0, 0.7) 100%
        );
    }

    /* === RESPONSIVE === */
    
    /* Mobile optimizations - usando tokens */
    @media (max-width: 768px) {
        .hero-background {
            height: 100svh; /* Safe viewport height */
        }
        
        /* Overlay ligeramente más fuerte en móvil para mejor legibilidad */
        .hero-overlay-white-optimized {
            background: rgba(0, 0, 0, 0.08);
        }
        
        :root[data-theme="light"] .hero-overlay-white-optimized,
        html[data-theme="light"] .hero-overlay-white-optimized {
            background: linear-gradient(
                rgba(0, 0, 0, 0.45) 0%,
                rgba(0, 0, 0, 0.5) 50%,
                rgba(0, 0, 0, 0.55) 100%
            );
        }
        
        .hero-background :global(.responsive-image-fallback .fallback-content) {
            padding: var(--space-8) var(--space-4);
        }
    }

    /* Tablet adjustments */
    @media (min-width: 768px) and (max-width: 1023px) {
        .hero-background :global(.responsive-image-fallback .fallback-content) {
            padding: var(--space-12) var(--space-6);
        }
    }

    /* Desktop optimizations */
    @media (min-width: 1024px) {
        .hero-background :global(.responsive-image-fallback .fallback-content) {
            padding: var(--space-16) var(--space-8);
        }
    }

    /* === TEMAS ESPECÍFICOS PARA FALLBACK === */
    [data-theme="light"] .hero-background :global(.responsive-image-fallback) {
        background: linear-gradient(135deg, 
            var(--dark-600) 0%, 
            var(--dark-400) 100%
        );
        color: #ffffff; /* Mantener blanco incluso en tema claro */
    }

    /* === ANIMACIONES === */
    .hero-background.animate-in {
        animation: heroFadeIn var(--duration-1000) var(--ease-out);
    }
    
    @keyframes heroFadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    /* === ACCESIBILIDAD === */
    
    /* Alto contraste - overlay más fuerte para mejorar legibilidad */
    @media (prefers-contrast: high) {
        .hero-overlay-white-optimized {
            background: rgba(0, 0, 0, 0.7) !important;
        }
        
        /* En alto contraste, todos los temas usan overlay oscuro fuerte */
        :root[data-theme="light"] .hero-overlay-white-optimized,
        html[data-theme="light"] .hero-overlay-white-optimized,
        :root[data-theme="gold"] .hero-overlay-white-optimized,
        html[data-theme="gold"] .hero-overlay-white-optimized,
        :root[data-theme="blue"] .hero-overlay-white-optimized,
        html[data-theme="blue"] .hero-overlay-white-optimized,
        :root[data-theme="restaurant"] .hero-overlay-white-optimized,
        html[data-theme="restaurant"] .hero-overlay-white-optimized {
            background: rgba(0, 0, 0, 0.8) !important;
        }
    }

    /* Movimiento reducido */
    @media (prefers-reduced-motion: reduce) {
        .hero-overlay-white-optimized {
            transition: none;
        }
        
        .hero-background.animate-in {
            animation: none;
        }
    }

    /* === OPTIMIZACIONES DE PERFORMANCE === */
    .hero-background {
        contain: layout style paint;
    }
    
    .hero-background.isolated {
        isolation: isolate;
    }

    .hero-overlay-white-optimized {
        will-change: background, opacity;
        backface-visibility: hidden;
    }

    /* === UTILIDADES DE DEBUG === */
    .hero-background.debug-overlays .hero-overlay {
        border: 2px solid red;
        opacity: 0.5;
    }
    
    .hero-background.debug-overlays .hero-overlay-white-optimized {
        border: 2px solid blue;
        opacity: 0.5;
    }

    /* === ESTADOS ADICIONALES === */
    .hero-background.loading {
        pointer-events: none;
    }

    .hero-background.loading::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.3);
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>